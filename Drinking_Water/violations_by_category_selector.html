<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Health-Based Drinking Water Violations by Rule Namee</title>
    <script src="https://code.jquery.com/jquery-3.1.1.js"></script>
    <script src="//code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>

    <!-- Bootstrap styles -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <!-- Montserrat font -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,700" rel="stylesheet">
    <script src="../js/export-csv_glc.js"></script>
    <script src="../js/DW_2022.js"></script>
    <script src="../js/BlueAccounting.js"></script>
    <link rel="stylesheet" href="../css/BA_Style.css">
	
    <style>
      #page-content {
        margin: 0 0 15px 60%;
        display: flex;
	      flex-wrap: wrap;
      }
  </style>
</head>
<body>

    
      <div class="page-content" id="selectors">
        <fieldset class="field_set">
          <legend>Select Jurisdiction</legend>
          <select id="measure" name="measure" style="font-family: 'Montserrat', sans-serif; font-size: 16">
              <option value="All" selected="selected">All Jurisdictions</option>
              <option value="IL">Illinois</option>
              <option value="IN">Indiana</option>
              <option value="MI">Michigan</option>
              <option value="MN">Minnesota</option>
              <option value="NY">New York</option>
              <option value="OH">Ohio</option>
              <option value="PA">Pennsylvania</option>
              <option value="WI">Wisconsin</option>
              <option value="EPA">EPA (Tribal Systems)</option>
          </select>
          <!--<select id="display" name="display" style="font-family: 'Montserrat', font-size: 16, sans-serif;">
              <option value="Loading and Discharge" selected="selected">Total Loading</option>
              <option value="Flow-Weighted Mean Concentration">FWMC</option>
   	      <option value="Percent Decrease">Percent Decrease</option> 
          </select>-->

      </fieldset>
    </div>
    <div id="chart" style="margin-right: 20px">
    </div>

<script>
    var BA = new BlueAccounting;
    var initJurisdiction = 'MI'
    
    Highcharts.setOptions({
        lang: {
            numericSymbols: null,
            thousandsSep: ','
        }
    });
	
    var DW = new DrinkingWater();
	
    var series = [];
	
    var colors = ["#0D5E87", "#0092B0", "#00C7C3", "#27651F", "#FFC461", "#7CFAC3", "#102A58"];
    
    $.getJSON("../data/test_file.json", function(d){
        data = d;
    }).done(function () {
		var returnedData = $.grep(data, function (element, index) {
			return element.State === (initJurisdiction);
		});


		for(let i =0;i < returnedData.length;i++){
			series.push({
				name: returnedData[i].Rule,
				data: returnedData[i].data,
				color: colors[i],
			});
		};
	});
	
	console.log(series);

	    
	  
	/*
    function loadChart(name) {
        function dataToArray(vals){
            let array = []
            for(let i =0;i < vals.length;i++){array.push(vals.get(i))}
            return array;
        }
	    

		var s1_data = DW.getJurisdictionData(name);
		var s1_data_array = dataToArray(s1_data);
	    	console.log( s1_data_array );


    } */
	
    
    ex_series = [
        {
            name: "Microbials",
            data: [180, 216, 204, 191, 204, 203, 149, 137, 147, 146, 161, 167],
            color: "#0D5E87"
        },
        {
            name: "Lead & Copper Rule",
            data: [291, 293, 299, 302, 304, 309, 315, 321, 331, 331, 343, 349],
            color: "#0092B0"
        },
        {
            name: "Disinfectants & disinfection byproducts",
            data: [133, 147, 137, 88, 149, 173, 155, 172, 170, 160, 166, 174],
            color: "#00C7C3"
        },
      
        {
            name: "Inorganic chemicals",
            data: [28, 23, 20, 19, 44, 30, 22, 25, 17, 21, 13, 15],
            color: "#27651F"
        },
      
        {
            name: "Radionuclides",
            data: [9, 6, 4, 9, 1, 2, 6, 9, 7, 6, 0, 4],
            color: "#FFC461"
        },

        {
            name: "VOCs or SOCs",
            data: [3, 3, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            color: "#7CFAC3" //color: "#102A58"
        },


    ]
	
    console.log(ex_series);
   

Highcharts.chart("chart", {
    chart: {
        type: "column",
        height: 600,
        backgroundColor: {
            linearGradient: {x1: 0, x2: 1, y1: 1, y2: 0},
            stops: [
               [0, 'rgb(255,255,255)'],
               [1, '#F2FAFF']
            ]
        },
        accessibility: {
            description: 'Chart displays the number of violations of health-based rules under the US Safe Drinking Water Act (SDWA) incurred by community water systems located in the Great Lakes Basin. The Total Coliform and Revised Total Coliform Rules were associated with the most violations, approximately half of the health-based violations documented by US EPA for these states between 2012 and 2021 Q2.'
        }
    },
    title: {
        text: 'Annual Health-based Violations of Safe Drinking Water Act Rules in the Great Lakes Basin',
        margin: 20,
        widthAdjust: -370,
        style: {
            color: '#000000',
            fontWeight: 'bold'
        }
    },
    xAxis: {
        accessibility: {
            description: "Years from 2010 to 2021"
        },
        style: {
            fontSize: "13px"
        }
    },
    yAxis: {
        title: {
            text: 'Number of violations'
        },
        accessibility: {
            description: "Total number of health-based violations that were unresolved in each year"
        },
        style: {
            fontSize: "13px"
        }
    },
    legend: {
        title: {
            text: 'Rule Group<br/><span style="font-size: 9px; color: #666; font-weight: normal">(Click to hide)</span>'
        },
        width: 720,
        itemWidth: 180,
        useHTML: 'True',
        align: 'left',
        itemMarginBottom: 5,
        itemStyle : { "word-wrap": "break-word", "textOverflow": "undefined"},
        symbolHeight: 11,
        symbolWidth: 11,
        symbolRadius: 0
    },
    credits: {
        enabled: false,
    },
    caption: {
        text: '<b>Source: </b><em>US EPA Enforcement and Compliance History Online (ECHO), 2022, <a href="https://echo.epa.gov/">https://echo.epa.gov/</a></em><br><b>Notes: </b><em>VOCs: Volatile Organic Chemicals; SOCs: Synthetic Organic Chemicals; Inorganic Chemicals includes nitrates, arsenic, and other chemicals.</em>'
    },

    tooltip: {
        formatter: function() {
              return '<b>' + this.x + '</b><br/>'+
              this.series.name + ': ' + this.y + ' violations<br/>'+
              'Total for ' + this.x + ' :' + this.point.total + ' violations'
        }
    },
    
    plotOptions: {
        column: {
            stacking: 'normal',
            groupPadding: 0.1,
        },
        series: {
            label: {
                connectorAllowed: false
            },
            pointStart: 2010
        }
    },
	
    series: ex_series



});
</script>
</body>
</html>
