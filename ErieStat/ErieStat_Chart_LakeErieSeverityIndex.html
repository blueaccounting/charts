<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lake Erie Bloom Severity Index</title>

    <script src="https://code.jquery.com/jquery-3.1.1.js"></script>

    <script src="//code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.src.js"></script> 

    <!-- zipcelx is a non-Highcharts dependency for exporting to XLS and XLSX. It
    is licenced under the MIT license, see
    https://github.com/egeriis/zipcelx/blob/master/LICENSE -->
    <script src="https://cdn.jsdelivr.net/gh/egeriis/zipcelx/lib/standalone.js"></script>
    
    <!--<script src="js/ba_chart2.js"></script>-->
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <link rel="stylesheet" href="../css/BA_Style.css">
    <!-- Bootstrap styles -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <!-- Montserrat font -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,700" rel="stylesheet">
</head>
    
<body>
<!--<div id="chart-canvas">-->
    <div id="chart" style="mr-20">
    <!--</div>-->
    <!--<div id="chart2" style="margin-right: 20px">-->
    <!--</div>-->
    <!--<div id="chart3">-->
    <!--</div>-->
</div>

<script>
    // Highcharts plugin for adding better XLS and XLSX support through the third
// party zipcelx library.
    (function (H) {
        if (window.zipcelx && H.getOptions().exporting) {
            H.Chart.prototype.downloadXLSX = function () {
                const div = document.createElement('div');
                let name,
                    xlsxRows = [];
                div.style.display = 'none';
                document.body.appendChild(div);
                const rows = this.exporting.getDataRows(true);
                xlsxRows = rows.slice(1).map(function (row) {
                    return row.map(function (column) {
                        return {
                            type: typeof column === 'number' ? 'number' : 'string',
                            value: column
                        };
                    });
                });
    
                // Get the filename, copied from the Chart.fileDownload function
                if (this.options.exporting.filename) {
                    name = this.options.exporting.filename;
                } else if (this.title && this.title.textStr) {
                    name = this.title.textStr.replace(/ /g, '-').toLowerCase();
                } else {
                    name = 'chart';
                }
    
                window.zipcelx({
                    filename: name,
                    sheet: {
                        data: xlsxRows
                    }
                });
            };
    
            // Default lang string, overridable in i18n options
            H.getOptions().lang.downloadXLSX = 'Download XLSX';
    
            // Add the menu item handler
            H.getOptions().exporting.menuItemDefinitions.downloadXLSX = {
                textKey: 'downloadXLSX',
                onclick: function () {
                    this.downloadXLSX();
                }
            };
    
            // Replace the menu item
            const menuItems =
             H.getOptions().exporting.buttons.contextButton.menuItems;
            menuItems[menuItems.indexOf('downloadXLS')] = 'downloadXLSX';
        }
    }(Highcharts));
    var chart = Highcharts.chart("chart", {
        chart: {
            // width: 1000,
            height: 600,
            backgroundColor: {                
                linearGradient: {x1: 0, x2: 1, y1: 1, y2: 0},
                stops: [
                   [0, 'rgb(255,255,255)'],
                   [1, '#F2FAFF']
                ]
            },
            accessibility: {
                description: 'Chart displays the annual severity index for cyanobacterial algae blooms in western Lake Erie for the years 2000 to 2024 and the current predicted bloom severity for 2025 as projected by the NOAA National Centers for Coastal Ocean Science.  The chart also shows the annual severity index target of a maximum of 2.9.'
            },
            /* events: {
                load: function () {
                    var logoX = 15;
                    var size = this.plotBox.y;
                    size -= 40;

                    if(this.chartWidth < 500){
                        logoX = 10;
                        // size = this.chartWidth / 10;
                    }
                    var img_width = (this.chartWidth - 350)/2 - logoX;
                    var img_height = size;
                    // var img_url = "";
                    if(img_width >= img_height*4){
                        // wide logo
                        this.renderer.image("https://c1.staticflickr.com/1/826/26966705327_f80fcd7af1_o.png", logoX, 0, size * 4, size ).add();
                        // ErieStat logo. Change factor to 3
                        // this.renderer.image("https://c1.staticflickr.com/1/956/27966542108_a46fd4fa96_o.png", logoX, 0, size*3 , size).add();
                    }else{
                        // cube logo
                        this.renderer.image("https://c1.staticflickr.com/1/868/40969378165_8bd2c065b9_o.png", logoX, 0, size, size).add();
                    }
                    // var w = this.chartWidth - this.title.alignAttr.x;
                    // Blue Accounting Cube logo
                    // this.renderer.image("https://c1.staticflickr.com/1/868/40969378165_8bd2c065b9_o.png", logoX, 0, size, size).add();
                    // Blue Accouting Logo
                    // this.renderer.image("https://c1.staticflickr.com/1/826/26966705327_f80fcd7af1_o.png", logoX, 0, size * 4, size ).add();
                    // Blue Accounting ErieStat Logo
                    // this.renderer.image("https://c1.staticflickr.com/1/956/27966542108_a46fd4fa96_o.png", logoX, 0, size*3 , size).add();

                    // this.renderer.image("https://c1.staticflickr.com/5/4382/36578347693_3c6032000b_o.png", 0, 0, chart_width, chart_height).add();   //red watermark
//                if (isBgImg) {
//                    this.renderer.image("img/background_draft.png", this.plotLeft, this.plotTop, this.plotWidth, this.plotHeight).add(); //grey watermark
//                }
                }
            }
            */
        },
        exporting: {
            enabled: true,
            allowHTML: true,
            sourceWidth: 900,
            sourceHeight: 630,
            csv: {
                columnHeaderFormatter: function(item, key) {
                    if (!item || item instanceof Highcharts.Axis) {
                        return 'Year'
                    } else {
                        return item.name;
                    }
                }
            }
        },
        title: {
            text: 'Lake Erie Bloom Severity Index',
            margin: 40,
            widthAdjust: -200,
            style: {
                color: '#000000',
                fontWeight: 'bold',
                fontSize: '1.6em'
            }
        },
        xAxis: {
            accessibility: {
                description: "Years from 2000 to 2025"
            },
            labels: {
                style: {
                    fontSize: '12px'
                }
            },
        },
        yAxis: {
            title: {
                text: 'Bloom Severity',
                style: {
                    fontSize: '1.1em'
                }
            },
            accessibility: {
                description: "Cyanobacterial algae bloom severity",
            },
            reversedStacks: false ,
            labels: {
                style: {
                    fontSize: '12px'
                }
            },
        },
            
        legend: {
            // itemWidth: 200,
            itemMarginBottom: 8,
            itemDistance: 25,
            itemWidth: 220, 
            symbolHeight: 11,
            symbolWidth: 11,
            symbolRadius: 0,
            itemMarginBottom: 8,
            itemStyle: {"word-wrap": "break-word", color: "#000000", fontWeight: "normal", fontSize: '1.2em' }
        },
            
        credits: {
            enabled: false,
        },
        
        caption: {
            text: '<b>Chart source: </b><em>Great Lakes Commission, Blue Accounting, 2025, <a href="https://www.blueaccounting.org/metric/habs/"  target="_blank">https://www.blueaccounting.org/metric/habs/</a></em> <br> <b>Data source: </b> <em><a href="https://coastalscience.noaa.gov/science-areas/habs/hab-monitoring-system/" target="_blank">NOAA National Centers for Coastal Ocean Science (NCCOS) HAB Monitoring Program</a></em>',
            style: {
                fontSize: '12px' 
            }
        },

        plotOptions: {
            column: {
                grouping: false   // Exactly overlap
            },
            series: {
                pointPadding: 0.05,
                label: {
                    connectorAllowed: false
                },
                pointStart: 2000
            }
        },

        tooltip: {
            shared: true,
            style: {
                fontSize: '1em'
            }
        },

        series: [{
            name: 'Observed bloom severity',
            type: 'column',
            data: [0.3,
                0.3,
                0.3,
                5, 
                1.9, 
                0.3, 
                2.1, 
                1.1, 
                6, 
                5.8, 
                5.4, 
                10, 
                4.6, 
                7.3, 
                4.9, 
                8.3, 
                2.8, 
                6.8, 
                2.1, 
                5.7, 
                1.4, 
                3,
                4.1,
                2.5,
                3.9
            ],
            color: '#0D5E87'
        }, {
            name: 'Likely Range of 2025 Bloom Severity as of June 5',
            type: 'columnrange',
            data: [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [2.5, 4.5]],
            color: '#6FC212'
        },/* {
            name: 'Likely Range of 2025 <br>Bloom Severity',
            type: 'errorbar',
            whiskerLength: 0,
            stemWidth: 2,
            tooltip: {
                pointFormat: 'Likely range: <b>{point.low}-{point.high}</b><br>'
            },
            data: [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [4.5, 6]],
            color: 'black'
        }, { 
            name: 'Seasonal projection of <br>2024 bloom severity <br>(with likely range) as of 7/25/24',
            type: 'scatter',
            marker: {
                radius: 7,
            },
            tooltip: {
                headerFormat: '2024<br>',
                pointFormat: 'NOAA forecast: <b>{point.y:.1f}</b><br>'

            },
            data: [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, 5],
            color: '#6FC212'
        }, */{ 
            name: "Target",
            type: 'line',
            lineWidth: 3,
            marker: {
                radius: 0
            },
            data: [2.9 , 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9, 2.9],
            color: "#E07000"
        }],
    });

        
</script>
</body>
</html>
</body>
</html>
